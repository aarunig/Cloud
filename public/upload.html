<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Upload • MediLocker</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Poppins',sans-serif;
      background:linear-gradient(135deg,#667eea,#764ba2);
      min-height:100vh;
      color:white;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:40px 20px;
    }
    h1{
      font-size:48px;
      background:linear-gradient(45deg,#fff,#cdd6ff);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      margin-bottom:10px;
    }
    .container{
      background:rgba(255,255,255,0.15);
      backdrop-filter:blur(20px);
      border-radius:28px;
      padding:50px;
      width:90%;
      max-width:600px;
      box-shadow:0 25px 60px rgba(0,0,0,0.4);
      border:1px solid rgba(255,255,255,0.2);
      text-align:center;
    }
    .drop-zone{
      border:3px dashed rgba(255,255,255,0.4);
      border-radius:20px;
      padding:60px 20px;
      background:rgba(255,255,255,0.1);
      cursor:pointer;
      transition:0.3s;
      margin:20px 0;
    }
    .drop-zone:hover{
      background:rgba(255,255,255,0.2);
      border-color:white;
    }
    .drop-zone.dragover{
      background:rgba(255,255,255,0.3);
      border-color:#fff;
    }
    input[type="file"]{display:none}
    button{
      padding:18px 50px;
      background:white;
      color:#667eea;
      border:none;
      border-radius:50px;
      font-size:19px;
      font-weight:700;
      cursor:pointer;
      margin:20px 10px;
      transition:0.3s;
    }
    button:hover{transform:scale(1.05)}
    .upload-btn{background:#667eea;color:white}
    .upload-btn:hover{background:#5a67d8}
    #status{margin:25px 0;font-size:18px}
    .progress{
      width:100%;
      height:12px;
      background:rgba(255,255,255,0.2);
      border-radius:50px;
      overflow:hidden;
      margin:20px 0;
      display:none;
    }
    .progress-fill{
      width:0%;
      height:100%;
      background:#4ade80;
      transition:width 0.4s;
    }
    .file-info{
      margin:15px 0;
      padding:15px;
      background:rgba(255,255,255,0.1);
      border-radius:12px;
      font-size:16px;
    }
    a{color:white;margin-top:30px;display:inline-block;text-decoration:none;font-size:17px}
    a:hover{text-decoration:underline}
  </style>
</head>
<body>

<h1>MediLocker</h1>
<p style="font-size:20px;margin-bottom:30px">Secure Medical File Upload</p>

<div class="container">
  <div class="drop-zone" id="dropZone">
    <p style="font-size:40px;margin:10px">Upload</p>
    <p>Click here or drag & drop your file</p>
    <p style="font-size:14px;margin-top:10px;color:#ddd">(PDF, JPG, PNG, DOC up to 100MB)</p>
  </div>
  <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx">

  <div class="file-info" id="fileInfo" style="display:none"></div>

  <div class="progress" id="progress"><div class="progress-fill" id="progressFill"></div></div>

  <button class="upload-btn" onclick="uploadFile()">Upload to Cloud</button>
  <button onclick="document.getElementById('fileInput').click()">Choose File</button>

  <div id="status"></div>

  <br><br>
  <a href="dashboard.html">← Back to Dashboard</a>
</div>

<script>
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const fileInfo = document.getElementById('fileInfo');
const progress = document.getElementById('progress');
const progressFill = document.getElementById('progressFill');
const status = document.getElementById('status');

['dragover', 'dragenter'].forEach(e => dropZone.addEventListener(e, () => dropZone.classList.add('dragover')));
['dragleave', 'dragend', 'drop'].forEach(e => dropZone.addEventListener(e, () => dropZone.classList.remove('dragover')));

dropZone.onclick = () => fileInput.click();

fileInput.onchange = () => {
  const file = fileInput.files[0];
  if (file) {
    fileInfo.style.display = 'block';
    fileInfo.innerHTML = `<strong>${file.name}</strong><br>Size: ${(file.size/1024/1024).toFixed(2)} MB`;
  }
};

dropZone.ondrop = e => {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  if (e.dataTransfer.files.length) {
    fileInput.files = e.dataTransfer.files;
    fileInfo.style.display = 'block';
    fileInfo.innerHTML = `<strong>${e.dataTransfer.files[0].name}</strong><br>Size: ${(e.dataTransfer.files[0].size/1024/1024).toFixed(2)} MB`;
  }
};

async function uploadFile() {
  const file = fileInput.files[0];
  if (!file) return status.innerHTML = "Please select a file first!";

  const formData = new FormData();
  formData.append("file", file);

  status.innerHTML = "Uploading...";
  progress.style.display = "block";
  progressFill.style.width = "0%";

  try {
    const res = await fetch("http://127.0.0.1:5001/api/upload", {
      method: "POST",
      body: formData
    });

    const data = await res.json();

    if (data.success) {
      progressFill.style.width = "100%";
      status.innerHTML = `
        <div style="background:#d4edda;color:#155724;padding:20px;border-radius:16px;margin:20px 0;font-size:18px">
          SUCCESS! File uploaded successfully<br><br>
          <a href="${data.url}" target="_blank" style="color:#155724;font-weight:bold;text-decoration:underline">Open File</a>
        </div>`;
    } else {
      status.innerHTML = `<div style="background:#f8d7da;color:#721c24;padding:20px;border-radius:16px">Failed: ${data.message}</div>`;
    }
  } catch (err) {
    status.innerHTML = `<div style="background:#f8d7da;color:#721c24;padding:20px;border-radius:16px">Server not running!<br>Run: node server.js</div>`;
  }
}
</script>

</body>
</html>